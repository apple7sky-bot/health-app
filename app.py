import streamlit as st
import random

# 부위별 운동 라이브러리
운동목록 = {
    '가슴': ['벤치프레스', '인클라인 덤벨 프레스', '딥스', '케이블 크로스오버', '덤벨 플라이', '인클라인 벤치 프레스'],
    '등': ['풀업', '케이블 로우', '랫 풀 다운', '시티드 케이블 로우', '원암 덤벨 로우', '티바 로우'],
    '하체': ['스쿼트', '데드리프트', '레그 프레스', '핵스쿼트', '레그 익스텐션', '레그 컬'],
    '어깨': ['오버헤드 프레스', '사이드 레터럴 레이즈', '벤트 오버 레이즈', '페이스 풀', '슈러그'],
    '이두': ['바벨 컬', '덤벨 컬', '해머 컬'],
    '삼두': ['케이블 푸쉬 다운', '라잉 트라이셉스 익스텐션', '오버헤드 익스텐션','케이블 오버헤드 익스텐션']
}

# 하루 총 운동 개수
하루운동개수 = 6

# 부위별 최소 운동 개수
부위별최소개수 = {
    '가슴': 4, '등': 4, '하체': 4, '어깨': 3, '이두': 2, '삼두': 2
}

# 주당 횟수별 루틴 템플릿
주간루틴 = {
    1: [['가슴', '등', '하체']],
    2: [['가슴', '등', '어깨'], ['하체', '이두', '삼두']],
    3: [['가슴', '이두'], ['등', '삼두'], ['하체', '어깨']],
    4: [['가슴'], ['등'], ['하체'], ['어깨', '이두', '삼두']],
    5: [['가슴'], ['등'], ['하체'], ['어깨'], ['이두', '삼두']],
    6: [['가슴', '이두'], ['등', '삼두'], ['하체', '어깨'], ['가슴', '이두'], ['등', '삼두'], ['하체']],
    7: [['가슴', '이두'], ['등', '삼두'], ['하체', '어깨'], ['가슴'], ['등'], ['하체'], ['어깨', '이두', '삼두']]
}



def workout(운동할부위들):
    # 하루 6개 운동을 부위별로 분배하는 함수
    분배결과 = {}
    
    if len(운동할부위들) == 1:
        part = 운동할부위들[0]
        분배결과[part] = 하루운동개수
        return 분배결과

    남은자리 = 하루운동개수
    for part in 운동할부위들:
        최소개수 = 부위별최소개수.get(part, 1)
        확정개수 = min(남은자리, 최소개수)
        분배결과[part] = 확정개수
        남은자리 -= 확정개수
    
    if 남은자리 > 0:
        main_part = 운동할부위들[0]
        분배결과[main_part] += 남은자리
        
    return 분배결과


# 웹 화면

st.title('헬스 루틴 생성기 💪')

운동횟수 = st.number_input(
    '이번 주는 몇 회 운동할 거예요? (1-7일)', 
    min_value=1, max_value=7, value=3
)

if st.button('루틴 생성'):
    이번주플랜 = 주간루틴[운동횟수]
    
    st.write("---")
    st.subheader(f"주 {운동횟수}일, 90분 루틴 완성!")
    
    파일내용 = f"주 {운동횟수}일 운동 루틴\n" + "="*20 + "\n\n"

    for i, day_parts in enumerate(이번주플랜):
        day_plan = workout(day_parts)
        
        title_parts = [f"{part}({count}개)" for part, count in day_plan.items()]
        title = f"Day {i+1}: {', '.join(title_parts)}"
        
        파일내용 += f"** {day_title} **\n"

        with st.expander(f"**{day_title}**", expanded=(i==0)):
            for part, count in day_plan.items():
                뽑을개수 = min(count, len(운동목록[part]))
                추천운동 = random.sample(운동목록[part], 뽑을개수)
                
                for ex in 추천운동:
                    st.write(f"- {ex}")
                    파일내용 += f"- {ex}\n"
            
            파일내용 += "\n"

    st.write("---")

    st.download_button(
       label="📥 이 루틴 파일로 저장",
       data=파일내용,
       file_name=f"주{운동횟수}일_운동루틴.txt",
       mime='text/plain',
    )

